<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using short lived postgres servers for testing | Robin's blog</title>
<meta name=keywords content="postgres,testing,cicd,eugene"><meta name=description content="Database servers are usually long-lived, and important parts of the infrastructure
that we build on. We rarely set them up from scratch, because we have to take
such good care of them over time. I think this causes a lot of people to think
that setting up a database server is some mysteriously difficult ordeal. To be clear,
that&rsquo;s actually true, if you need high availability and a solid recovery point objective.
But there are a lot of use cases where that&rsquo;s overkill, for example short-lived
test environments, or CI/CD pipelines."><meta name=author content="Robin Kåveland"><link rel=canonical href=https://kaveland.no/posts/2024-05-27-shortlived-postgres-servers/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://kaveland.no/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kaveland.no/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kaveland.no/favicon-32x32.png><link rel=apple-touch-icon href=https://kaveland.no/apple-touch-icon.png><link rel=mask-icon href=https://kaveland.no/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kaveland.no/posts/2024-05-27-shortlived-postgres-servers/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer data-domain=kaveland.no src=https://plausible.io/js/script.js></script><meta property="og:title" content="Using short lived postgres servers for testing"><meta property="og:description" content="Database servers are usually long-lived, and important parts of the infrastructure
that we build on. We rarely set them up from scratch, because we have to take
such good care of them over time. I think this causes a lot of people to think
that setting up a database server is some mysteriously difficult ordeal. To be clear,
that&rsquo;s actually true, if you need high availability and a solid recovery point objective.
But there are a lot of use cases where that&rsquo;s overkill, for example short-lived
test environments, or CI/CD pipelines."><meta property="og:type" content="article"><meta property="og:url" content="https://kaveland.no/posts/2024-05-27-shortlived-postgres-servers/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-27T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-27T00:00:00+00:00"><meta property="og:site_name" content="Robin's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using short lived postgres servers for testing"><meta name=twitter:description content="Database servers are usually long-lived, and important parts of the infrastructure
that we build on. We rarely set them up from scratch, because we have to take
such good care of them over time. I think this causes a lot of people to think
that setting up a database server is some mysteriously difficult ordeal. To be clear,
that&rsquo;s actually true, if you need high availability and a solid recovery point objective.
But there are a lot of use cases where that&rsquo;s overkill, for example short-lived
test environments, or CI/CD pipelines."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kaveland.no/posts/"},{"@type":"ListItem","position":2,"name":"Using short lived postgres servers for testing","item":"https://kaveland.no/posts/2024-05-27-shortlived-postgres-servers/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using short lived postgres servers for testing","name":"Using short lived postgres servers for testing","description":"Database servers are usually long-lived, and important parts of the infrastructure that we build on. We rarely set them up from scratch, because we have to take such good care of them over time. I think this causes a lot of people to think that setting up a database server is some mysteriously difficult ordeal. To be clear, that\u0026rsquo;s actually true, if you need high availability and a solid recovery point objective. But there are a lot of use cases where that\u0026rsquo;s overkill, for example short-lived test environments, or CI/CD pipelines.\n","keywords":["postgres","testing","cicd","eugene"],"articleBody":"Database servers are usually long-lived, and important parts of the infrastructure that we build on. We rarely set them up from scratch, because we have to take such good care of them over time. I think this causes a lot of people to think that setting up a database server is some mysteriously difficult ordeal. To be clear, that’s actually true, if you need high availability and a solid recovery point objective. But there are a lot of use cases where that’s overkill, for example short-lived test environments, or CI/CD pipelines.\nEdit: Hacker news thread here, in which several people tip about testcontainers, which is great for running tests, both locally and in CI/CD. pgtemp can automate exactly the steps I describe in this post and seems like a great tool.\nThe postgres data directory A postgres installation is roughly split into two components:\nThe binaries, which are usually installed somewhere in PATH and are shared across the entire server. The data directory, which contains the state of the database cluster, including all the databases, tables, indexes, configuration and so on. Most binaries in the postgres installation accept -D or --pgdata as an argument to specify where to keep the state, or where to start from. Many times, we run one postgres instance per server, so that this is split is not obvious to people. I also think that on ubuntu, the default installation is set up so that there’s a postgres instance already set up somewhere under /var/lib/postgresql and it makes it sort of look like you can only have the one.\nBut it’s really easy to set up a new postgres instance on a server that has the postgres binaries. Here’s what you need to do:\n# Create a new directory for the data mkdir -p /tmp/throwaway-postgres # Set up the data directory initdb -D /tmp/throwaway-postgres # Start postgres in there pg_ctl -D /tmp/throwaway-postgres start # Stop it again pg_ctl -D /tmp/throwaway-postgres stop If you need to configure anything, you can do that in the postgresql.conf that is generated in the data directory, or you can pass additional arguments to pg_ctl when you start the server. If you prefer to keep postgres in the foreground in the shell, you can use postgres -D /tmp/throwaway-postgres instead of pg_ctl start. If you prefer to use pg_ctl, but have to pass options, you can use -o to pass options to the postgres command, for example to run on a different port, you’d say:\npg_ctl -D /tmp/throwaway-postgres -o \"-p 5433\" start This makes it really easy to run many postgres instances on the same server, and you also don’t really need something like docker to run postgres in your local dev environment. You can just set up a new data directory for each project, and start and stop the server as you need it, or just run it in the foreground in the shell. If you do this, you probably want to use something like mise to make sure that all developers use the version of postgres that you plan on using in production.\nI need my instances to have data What we’ve learned about the -D option makes it really easy to set up many empty postgres instances. The next hurdle then, would generally be to populate the instances with some data, so that our tests or applications can actually use them. My preferred pattern for this is to have a single instance that is stable and set up with the data that I need, then clone from that to make new instances. Suppose you have a stable permanent test environment, for example. Then, this is also really simple:\n# Either set up PGPASSWORD or use a .pgpass file export PGPASSWORD=postgres pg_basebackup -D /tmp/throwaway-postgres \\ --checkpoint=fast --progress \\ --host the-stable-instance -U postgres pg_ctl -D /tmp/throwaway-postgres -o \"-p 5433\" start This is a really fast way to set up a temporary postgres instance, even if there’s a bit of data in the-stable-instance. The pg_basebackup command takes a binary snapshot of the -D directory of the stable instance, and replays any transactions that happened during the backup. This shouldn’t take more than a couple of minutes for a small database of 15-30GB, and you get an exact copy of the stable instance, with users, databases, configuration, and all the data.\nNote that pg_basebackup isn’t guaranteed to work across different major versions of postgres, or different CPU architectures, you’ll still need pg_dump for some situations. But if you want to be able to quickly set up databases for testing, you should check if pg_basebackup will work for you, before reaching for pg_dump.\nMaking dynamic instances in kubernetes If you’re running in a kubernetes cluster, you can use the same pattern to set up a new postgres instance in a pod very easily. You’ll need to create a new pod with an initContainer that runs pg_basebackup to set up the data directory, then start the postgres instance in the main container. We do this at my current project to set up complete short-lived environments for manual testing and demo purposes, and it works quite well. It takes a few minutes to deploy a complete environment with a ~15GB database instance. It’s also a useful trick to test database migrations on a realistic dataset before deploying them to production.\nThis seems like complete overkill for my use case I think this is overkill if you only have a single database in the instance, and it doesn’t contain a lot of data. At that point, you can still use this template idea, and maintain a single stable database in a single database server, then use create database $uuid template stable_db to set up a new database quickly. You can read more about that idea in a previous blog post here.\nUsing it for fun and profit for eugene For a while now, I’ve been working on the eugene trace command over at the eugene repository, and I’ve been pondering how to make it easier for people to get started with it. In the weekend, I remembered this pattern that I’ve used many times before, and I thought maybe eugene trace can just bring its own postgres instance to the party. With the 0.5.0 release, it does just that. If you have docker installed, you can run eugene trace in a directory that has flyway-style migrations like this:\ndocker run --rm -v $(pwd):/migrations \\ ghcr.io/kaaveland/eugene:0.5.0 trace /migrations There’s no setup required and the container is gone when the command finishes.\n","wordCount":"1082","inLanguage":"en","datePublished":"2024-05-27T00:00:00Z","dateModified":"2024-06-27T00:00:00Z","author":{"@type":"Person","name":"Robin Kåveland"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kaveland.no/posts/2024-05-27-shortlived-postgres-servers/"},"publisher":{"@type":"Organization","name":"Robin's blog","logo":{"@type":"ImageObject","url":"https://kaveland.no/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kaveland.no/ accesskey=h title="Robin's blog (Alt + H)">Robin's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kaveland.no/about/ title=about><span>about</span></a></li><li><a href=https://kaveland.no/projects/ title=projects><span>projects</span></a></li><li><a href=https://kaveland.no/eugene/ title=eugene><span>eugene</span></a></li><li><a href=https://kaveland.no/thumper/ title=thumper><span>thumper</span></a></li><li><a href=https://kaveland.no/tags/ title=tags><span>tags</span></a></li><li><a href=https://kaveland.no/archives/ title=archives><span>archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kaveland.no/>Home</a>&nbsp;»&nbsp;<a href=https://kaveland.no/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Using short lived postgres servers for testing</h1><div class=post-meta><span title='2024-05-27 00:00:00 +0000 UTC'>May 27, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1082 words&nbsp;·&nbsp;Robin Kåveland&nbsp;|&nbsp;<a href=https://github.com/kaaveland/kaaveland.github.io/content/posts/2024-05-27-shortlived-postgres-servers.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#the-postgres-data-directory>The postgres data directory</a></li><li><a href=#i-need-my-instances-to-have-data>I need my instances to have data</a></li><li><a href=#making-dynamic-instances-in-kubernetes>Making dynamic instances in kubernetes</a></li><li><a href=#this-seems-like-complete-overkill-for-my-use-case>This seems like complete overkill for my use case</a></li><li><a href=#using-it-for-fun-and-profit-for-eugene>Using it for fun and profit for eugene</a></li></ul></nav></div></details></div><div class=post-content><p>Database servers are usually long-lived, and important parts of the infrastructure
that we build on. We rarely set them up from scratch, because we have to take
such good care of them over time. I think this causes a lot of people to think
that setting up a database server is some mysteriously difficult ordeal. To be clear,
that&rsquo;s actually true, if you need high availability and a solid recovery point objective.
But there are a lot of use cases where that&rsquo;s overkill, for example short-lived
test environments, or CI/CD pipelines.</p><p>Edit: Hacker news thread <a href="https://news.ycombinator.com/item?id=40813479">here</a>, in
which several people tip about <a href=https://testcontainers.com/>testcontainers</a>, which
is great for running tests, both locally and in CI/CD.
<a href=https://github.com/boustrophedon/pgtemp>pgtemp</a> can automate exactly the steps I
describe in this post and seems like a great tool.</p><h2 id=the-postgres-data-directory>The postgres data directory<a hidden class=anchor aria-hidden=true href=#the-postgres-data-directory>#</a></h2><p>A postgres installation is roughly split into two components:</p><ul><li>The binaries, which are usually installed somewhere in <code>PATH</code> and are shared across
the entire server.</li><li>The data directory, which contains the state of the database cluster, including
all the databases, tables, indexes, configuration and so on. Most binaries in
the postgres installation accept <code>-D</code> or <code>--pgdata</code> as an argument to specify
where to keep the state, or where to start from.</li></ul><p>Many times, we run one postgres instance per server, so that this is split is not
obvious to people. I also think that on ubuntu, the default installation is set up
so that there&rsquo;s a postgres instance already set up somewhere under
<code>/var/lib/postgresql</code> and it makes it sort of look like you can only have the one.</p><p>But it&rsquo;s really easy to set up a new postgres instance on a server that
has the postgres binaries. Here&rsquo;s what you need to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Create a new directory for the data</span>
</span></span><span class=line><span class=cl>mkdir -p /tmp/throwaway-postgres
</span></span><span class=line><span class=cl><span class=c1># Set up the data directory</span>
</span></span><span class=line><span class=cl>initdb -D /tmp/throwaway-postgres
</span></span><span class=line><span class=cl><span class=c1># Start postgres in there</span>
</span></span><span class=line><span class=cl>pg_ctl -D /tmp/throwaway-postgres start
</span></span><span class=line><span class=cl><span class=c1># Stop it again</span>
</span></span><span class=line><span class=cl>pg_ctl -D /tmp/throwaway-postgres stop
</span></span></code></pre></div><p>If you need to configure anything, you can do that in the <code>postgresql.conf</code>
that is generated in the data directory, or you can pass additional arguments
to <code>pg_ctl</code> when you start the server. If you prefer to keep postgres in the
foreground in the shell, you can use <code>postgres -D /tmp/throwaway-postgres</code> instead
of <code>pg_ctl start</code>. If you prefer to use <code>pg_ctl</code>, but have to pass options, you
can use <code>-o</code> to pass options to the postgres command, for example to run on a
different port, you&rsquo;d say:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>pg_ctl -D /tmp/throwaway-postgres -o <span class=s2>&#34;-p 5433&#34;</span> start
</span></span></code></pre></div><p>This makes it really easy to run many postgres instances on the same server,
and you also don&rsquo;t really need something like docker to run postgres in your
local dev environment. You can just set up a new data directory for each
project, and start and stop the server as you need it, or just run it
in the foreground in the shell. If you do this, you probably want to use
something like <a href=https://mise.jdx.dev/getting-started.html>mise</a> to make
sure that all developers use the version of postgres that you plan on
using in production.</p><h2 id=i-need-my-instances-to-have-data>I need my instances to have data<a hidden class=anchor aria-hidden=true href=#i-need-my-instances-to-have-data>#</a></h2><p>What we&rsquo;ve learned about the <code>-D</code> option makes it really easy to set up
many empty postgres instances. The next hurdle then, would generally be to
populate the instances with some data, so that our tests or applications can
actually use them. My preferred pattern for this is to have a single instance
that is stable and set up with the data that I need, then clone from that to
make new instances. Suppose you have a stable permanent test environment, for
example. Then, this is also really simple:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Either set up PGPASSWORD or use a .pgpass file</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PGPASSWORD</span><span class=o>=</span>postgres
</span></span><span class=line><span class=cl>pg_basebackup -D /tmp/throwaway-postgres <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --checkpoint<span class=o>=</span>fast --progress <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --host the-stable-instance -U postgres
</span></span><span class=line><span class=cl>pg_ctl -D /tmp/throwaway-postgres -o <span class=s2>&#34;-p 5433&#34;</span> start
</span></span></code></pre></div><p>This is a really fast way to set up a temporary postgres instance, even if
there&rsquo;s a bit of data in <code>the-stable-instance</code>. The <code>pg_basebackup</code> command
takes a binary snapshot of the <code>-D</code> directory of the stable instance, and
replays any transactions that happened during the backup. This shouldn&rsquo;t
take more than a couple of minutes for a small database of 15-30GB, and
you get an exact copy of the stable instance, with users, databases,
configuration, and all the data.</p><p>Note that <code>pg_basebackup</code> isn&rsquo;t guaranteed to work across different major
versions of postgres, or different CPU architectures, you&rsquo;ll still need
<code>pg_dump</code> for some situations. But if you want to be able to quickly set
up databases for testing, you should check if <code>pg_basebackup</code> will work
for you, before reaching for <code>pg_dump</code>.</p><h2 id=making-dynamic-instances-in-kubernetes>Making dynamic instances in kubernetes<a hidden class=anchor aria-hidden=true href=#making-dynamic-instances-in-kubernetes>#</a></h2><p>If you&rsquo;re running in a kubernetes cluster, you can use the same pattern to
set up a new postgres instance in a pod very easily. You&rsquo;ll need to create
a new pod with an <code>initContainer</code> that runs <code>pg_basebackup</code> to set up the
data directory, then start the postgres instance in the main container. We
do this at my current project to set up complete short-lived environments
for manual testing and demo purposes, and it works quite well. It takes
a few minutes to deploy a complete environment with a ~15GB database
instance. It&rsquo;s also a useful trick to test database migrations on a
realistic dataset before deploying them to production.</p><h2 id=this-seems-like-complete-overkill-for-my-use-case>This seems like complete overkill for my use case<a hidden class=anchor aria-hidden=true href=#this-seems-like-complete-overkill-for-my-use-case>#</a></h2><p>I think this is overkill if you only have a single database in the
instance, and it doesn&rsquo;t contain a lot of data. At that point, you can
still use this template idea, and maintain a single stable database
in a single database server, then use <code>create database $uuid template stable_db</code>
to set up a new database quickly. You can read more about that idea
in a previous blog post <a href=/posts/2024-03-10-testing-transactions-that-commit>here</a>.</p><h2 id=using-it-for-fun-and-profit-for-eugene>Using it for fun and profit for eugene<a hidden class=anchor aria-hidden=true href=#using-it-for-fun-and-profit-for-eugene>#</a></h2><p>For a while now, I&rsquo;ve been working on the <code>eugene trace</code> command over
at <a href=https://github.com/kaaveland/eugene>the eugene repository</a>, and I&rsquo;ve
been pondering how to make it easier for people to get started with it. In
the weekend, I remembered this pattern that I&rsquo;ve used many times before,
and I thought maybe <code>eugene trace</code> can just bring its own postgres
instance to the party. With the <a href=https://github.com/kaaveland/eugene/releases/tag/0.5.0>0.5.0 release</a>,
it does just that. If you have docker installed, you can run <code>eugene trace</code> in
a directory that has flyway-style migrations like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker run --rm -v <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>:/migrations <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  ghcr.io/kaaveland/eugene:0.5.0 trace /migrations
</span></span></code></pre></div><p>There&rsquo;s no setup required and the container is gone when the command finishes.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kaveland.no/tags/postgres/>Postgres</a></li><li><a href=https://kaveland.no/tags/testing/>Testing</a></li><li><a href=https://kaveland.no/tags/cicd/>Cicd</a></li><li><a href=https://kaveland.no/tags/eugene/>Eugene</a></li></ul><nav class=paginav><a class=prev href=https://kaveland.no/posts/2024-06-27-salmon-ban/><span class=title>« Prev</span><br><span>Norwegian Wild Salmon Fishing Ban of 2024</span>
</a><a class=next href=https://kaveland.no/posts/2024-05-20-building-docsite-for-eugene/><span class=title>Next »</span><br><span>Building documentation for Eugene</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Using short lived postgres servers for testing on x" href="https://x.com/intent/tweet/?text=Using%20short%20lived%20postgres%20servers%20for%20testing&amp;url=https%3a%2f%2fkaveland.no%2fposts%2f2024-05-27-shortlived-postgres-servers%2f&amp;hashtags=postgres%2ctesting%2ccicd%2ceugene"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Using short lived postgres servers for testing on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fkaveland.no%2fposts%2f2024-05-27-shortlived-postgres-servers%2f&amp;title=Using%20short%20lived%20postgres%20servers%20for%20testing&amp;summary=Using%20short%20lived%20postgres%20servers%20for%20testing&amp;source=https%3a%2f%2fkaveland.no%2fposts%2f2024-05-27-shortlived-postgres-servers%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Using short lived postgres servers for testing on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fkaveland.no%2fposts%2f2024-05-27-shortlived-postgres-servers%2f&title=Using%20short%20lived%20postgres%20servers%20for%20testing"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Using short lived postgres servers for testing on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fkaveland.no%2fposts%2f2024-05-27-shortlived-postgres-servers%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Using short lived postgres servers for testing on whatsapp" href="https://api.whatsapp.com/send?text=Using%20short%20lived%20postgres%20servers%20for%20testing%20-%20https%3a%2f%2fkaveland.no%2fposts%2f2024-05-27-shortlived-postgres-servers%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Using short lived postgres servers for testing on telegram" href="https://telegram.me/share/url?text=Using%20short%20lived%20postgres%20servers%20for%20testing&amp;url=https%3a%2f%2fkaveland.no%2fposts%2f2024-05-27-shortlived-postgres-servers%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Using short lived postgres servers for testing on ycombinator" href="https://news.ycombinator.com/submitlink?t=Using%20short%20lived%20postgres%20servers%20for%20testing&u=https%3a%2f%2fkaveland.no%2fposts%2f2024-05-27-shortlived-postgres-servers%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://kaveland.no/>Robin's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>