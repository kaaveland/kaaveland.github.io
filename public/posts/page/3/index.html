<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | Robin's blog</title>
<meta name=keywords content><meta name=description content="Posts - Robin's blog"><meta name=author content="Robin Kåveland"><link rel=canonical href=https://kaveland.no/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://kaveland.no/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kaveland.no/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kaveland.no/favicon-32x32.png><link rel=apple-touch-icon href=https://kaveland.no/apple-touch-icon.png><link rel=mask-icon href=https://kaveland.no/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://kaveland.no/posts/index.xml><link rel=alternate hreflang=en href=https://kaveland.no/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer data-domain=kaveland.no src=https://plausible.io/js/script.js></script><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://kaveland.no/posts/"><meta property="og:site_name" content="Robin's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kaveland.no/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kaveland.no/ accesskey=h title="Robin's blog (Alt + H)">Robin's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kaveland.no/about/ title=about><span>about</span></a></li><li><a href=https://kaveland.no/projects/ title=projects><span>projects</span></a></li><li><a href=https://kaveland.no/eugene/ title=eugene><span>eugene</span></a></li><li><a href=https://kaveland.no/thumper/ title=thumper><span>thumper</span></a></li><li><a href=https://kaveland.no/tags/ title=tags><span>tags</span></a></li><li><a href=https://kaveland.no/archives/ title=archives><span>archives</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://kaveland.no/>Home</a></div><h1>Posts
<a href=/posts/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Using short lived postgres servers for testing</h2></header><div class=entry-content><p>Database servers are usually long-lived, and important parts of the infrastructure that we build on. We rarely set them up from scratch, because we have to take such good care of them over time. I think this causes a lot of people to think that setting up a database server is some mysteriously difficult ordeal. To be clear, that’s actually true, if you need high availability and a solid recovery point objective. But there are a lot of use cases where that’s overkill, for example short-lived test environments, or CI/CD pipelines.
...</p></div><footer class=entry-footer><span title='2024-05-27 00:00:00 +0000 UTC'>May 27, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1082 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Using short lived postgres servers for testing" href=https://kaveland.no/posts/2024-05-27-shortlived-postgres-servers/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Building documentation for Eugene</h2></header><div class=entry-content><p>I’ve been busy working on a documentation site for eugene, and I think it’s starting to look pretty good. I wanted to write down some of my thoughts around the process so far, and some of the things I’ve learned.
It’s just been a few days since I ported my blog to hugo, so since I was already feeling like I was up to speed on that, I decided I’d try using it for the eugene documentation too. I experimented with a few different setups around the hugo-book theme, but it ended up feeling like I was having to configure a bit too much for my taste. I think it looked really nice, but the setup felt a bit janky and complicated, with having the submodules and everything in the eugene repo itself. I think my problem here is just that doing this with hugo would require me to learn more about hugo than I’m ready for right now.
...</p></div><footer class=entry-footer><span title='2024-05-20 00:00:00 +0000 UTC'>May 20, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1343 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Building documentation for Eugene" href=https://kaveland.no/posts/2024-05-20-building-docsite-for-eugene/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Moving the blog to Hugo</h2></header><div class=entry-content><p>I’ve been using pelican for my blog for a while now, and I don’t really have anything negative to say about it. But for a while, I’ve been wanting a more minimal theme. I ended up on the front page of hacker news a couple of times, and the old theme had my face on all the pages, which made me feel a bit uncomfortable. I was looking at some other themes around the web, and I found PaperMod which I absolutely loved. I followed instructions for how to set it up, and it turns out that it only took me an hour or two to get everything up and running. I guess I have to give credit to where credit is due, both Hugo and PaperMod are really well-made, and easy to use. There’s a lot more stuff that Hugo can do, but I think I have everything I need set up for now.
...</p></div><footer class=entry-footer><span title='2024-05-18 00:00:00 +0000 UTC'>May 18, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;212 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Moving the blog to Hugo" href=https://kaveland.no/posts/2024-05-18-moving-to-hugo/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Linting postgres migration scripts</h2></header><div class=entry-content><p>I have been working quite a bit on picking up dangerous migration patterns in migration scripts over at the eugene repository lately. A major feature I’ve added is syntax tree analysis, so that we can pick up some patterns without having to run the SQL scripts. This isn’t quite as precise as running the scripts, but it’s a lot faster and can catch quite a few common mistakes. So let’s take a look at how it works!
...</p></div><footer class=entry-footer><span title='2024-05-16 00:00:00 +0000 UTC'>May 16, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1475 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Linting postgres migration scripts" href=https://kaveland.no/posts/2024-05-16-linting-postgres-migration-scripts/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Porting an application from cats effects to ZIO</h2></header><div class=entry-content><p>In my current project, we’re working on a large-ish code base that is written in Scala and uses cats effect as an effect system in large parts of the code base. If you’re not familiar with what an effect system is, I think the most important detail is that it’s a tool that gives you certain superpowers if you promise to be honest about it when your code does things that can be considered “effectful”, such as interacting with the network or reading files. We use the IO monad from cats effect, which is a wonderful way of writing async, concurrent code that looks a lot like synchronous code.
...</p></div><footer class=entry-footer><span title='2024-05-16 00:00:00 +0000 UTC'>May 16, 2024</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1649 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Porting an application from cats effects to ZIO" href=https://kaveland.no/posts/2024-05-16-porting-from-cats-effects-to-zio/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Careful with That Lock, Eugene: Part 2</h2></header><div class=entry-content><p>A while back, I wrote Careful with That Lock, Eugene about an idea for how to check if a database migration is likely to disturb production. That post came about after having an inspiring chat with a colleague about the advantages of transactional migration scripts and the ability to check the postgres system catalog views before committing a transaction.
Over the past few weeks, I’ve been experimenting with this idea to test if I can use it to build valuable safety checks for DDL migrations. Kind of like shellcheck, but for database DDL migrations.
...</p></div><footer class=entry-footer><span title='2024-05-06 00:00:00 +0000 UTC'>May 6, 2024</span>&nbsp;·&nbsp;13 min&nbsp;·&nbsp;2581 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Careful with That Lock, Eugene: Part 2" href=https://kaveland.no/posts/2024-05-06-careful-with-that-lock-eugene-pt-2/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Careful with That Lock, Eugene</h2></header><div class=entry-content><p>It is rewarding to work on software that people care about and use all around the clock. This constant usage means we can’t simply take the system offline for maintenance without upsetting users. Therefore, techniques that allow us to update the software seamlessly without downtime or compromising service quality are incredibly valuable.
Most projects I’ve worked on use a relational database for persistence, and have some sort of migration tool like flyway or liquibase to make changes to the database schema. This post is about a particular kind of migration situation that, in my experience, most developers who work on such projects will encounter at some point in their career. They will want to apply a simple, and seemingly innocent migration, like adding a column to a table and it’ll cause some number of requests to fail, or maybe even a small outage. There are some tricks we can use here to reduce risk and automatically detect some patterns that cause this problem.
...</p></div><footer class=entry-footer><span title='2024-04-12 00:00:00 +0000 UTC'>April 12, 2024</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1759 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Careful with That Lock, Eugene" href=https://kaveland.no/posts/2024-04-12-careful-with-that-lock-eugene/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How to test for missing indexes on foreign keys</h2></header><div class=entry-content><p>If you’re developing a transactional application backed by postgres, there’s a pretty cool trick you can use to check if you’re missing indexes that could potentially cause serious performance issues or even outages. In particular, I mean foreign keys where the referencing side of the constraint does not have an index. The idea is very simple, we can select all of the columns that take part in a foreign key, then remove the ones that take part in a complete index, and the remainder should be the empty set, or possibly match a known allowlist. I think this is a valuable addition to the test cases for your database migrations, or if you can’t easily do that, maybe in your CI/CD pipeline.
...</p></div><footer class=entry-footer><span title='2024-04-04 00:00:00 +0000 UTC'>April 4, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;665 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to How to test for missing indexes on foreign keys" href=https://kaveland.no/posts/2024-04-04-testcase-for-foreign-keys/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Friends don't let friends export to CSV</h2></header><div class=entry-content><p>I worked for a few years in the intersection between data science and software engineering. On the whole, it was a really enjoyable time and I’d like to have the chance to do so again at some point. One of the least enjoyable experiences from that time was to deal with big CSV exports. Unfortunately, this file format is still very common in the data science space. It is easy to understand why – it seems to be ubiquitous, present everywhere, it’s human-readable, it’s less verbose than options like JSON and XML, it’s super easy to produce from almost any tool. What’s not to like?
...</p></div><footer class=entry-footer><span title='2024-03-24 00:00:00 +0000 UTC'>March 24, 2024</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1915 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Friends don't let friends export to CSV" href=https://kaveland.no/posts/2024-03-10-friends-dont-let-friends-export-csv/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Isolating integration tests that commit transactions</h2></header><div class=entry-content><p>For tests that need to touch the database, it is generally a really good idea to roll back transactions. That way, you can run lots of tests in parallell or in any arbitrary order and the tests won’t interfere with each other. But sometimes, that just isn’t possible. One reason for this could be that the code base handles transactions in a way that makes it really hard to get a handle on them in the right place, or it could be a legacy code base where everything is running with auto-commit or some other explanation. Either way, it is very important to be able to isolate effectful tests from each other both to get good performance out of building on multi-core machines and to avoid flaky tests or tests that break when they run in a different order.
...</p></div><footer class=entry-footer><span title='2024-03-10 00:00:00 +0000 UTC'>March 10, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;403 words&nbsp;·&nbsp;Robin Kåveland</footer><a class=entry-link aria-label="post link to Isolating integration tests that commit transactions" href=https://kaveland.no/posts/2024-03-10-testing-transactions-that-commit/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://kaveland.no/posts/page/2/>«&nbsp;Prev&nbsp;
</a><a class=next href=https://kaveland.no/posts/page/4/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://kaveland.no/>Robin's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>