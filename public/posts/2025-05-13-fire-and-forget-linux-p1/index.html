<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>No-ops Linux part 1: Automation, security and essentials | Robin's blog</title>
<meta name=keywords content="cloud,linux,ops,cdn,duckdb,caddy,ansible"><meta name=description content="In Running containers on no-ops linux in 2025 I wrote about moving my hobby projects to a European cloud provider. I did an initial, manual setup in Hetzner, which I&rsquo;ve now automated. This weekend, I tested the setup. It takes me a few minutes now to get everything moved to a new host, and most of that has to do with DNS. I&rsquo;ve got a reproducible setup, I can quickly provision up a machine locally or in any cloud that has Ubuntu 24.04. Reproducible infrastructure is ‚ú®liberating‚ú®"><meta name=author content="Robin K√•veland"><link rel=canonical href=https://kaveland.no/posts/2025-05-13-fire-and-forget-linux-p1/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://kaveland.no/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kaveland.no/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kaveland.no/favicon-32x32.png><link rel=apple-touch-icon href=https://kaveland.no/apple-touch-icon.png><link rel=mask-icon href=https://kaveland.no/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kaveland.no/posts/2025-05-13-fire-and-forget-linux-p1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer data-domain=kaveland.no src=https://plausible.io/js/script.js></script><meta property="og:title" content="No-ops Linux part 1: Automation, security and essentials"><meta property="og:description" content="In Running containers on no-ops linux in 2025 I wrote about moving my hobby projects to a European cloud provider. I did an initial, manual setup in Hetzner, which I&rsquo;ve now automated. This weekend, I tested the setup. It takes me a few minutes now to get everything moved to a new host, and most of that has to do with DNS. I&rsquo;ve got a reproducible setup, I can quickly provision up a machine locally or in any cloud that has Ubuntu 24.04. Reproducible infrastructure is ‚ú®liberating‚ú®"><meta property="og:type" content="article"><meta property="og:url" content="https://kaveland.no/posts/2025-05-13-fire-and-forget-linux-p1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-13T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-13T00:00:00+00:00"><meta property="og:site_name" content="Robin's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="No-ops Linux part 1: Automation, security and essentials"><meta name=twitter:description content="In Running containers on no-ops linux in 2025 I wrote about moving my hobby projects to a European cloud provider. I did an initial, manual setup in Hetzner, which I&rsquo;ve now automated. This weekend, I tested the setup. It takes me a few minutes now to get everything moved to a new host, and most of that has to do with DNS. I&rsquo;ve got a reproducible setup, I can quickly provision up a machine locally or in any cloud that has Ubuntu 24.04. Reproducible infrastructure is ‚ú®liberating‚ú®"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kaveland.no/posts/"},{"@type":"ListItem","position":2,"name":"No-ops Linux part 1: Automation, security and essentials","item":"https://kaveland.no/posts/2025-05-13-fire-and-forget-linux-p1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"No-ops Linux part 1: Automation, security and essentials","name":"No-ops Linux part 1: Automation, security and essentials","description":"In Running containers on no-ops linux in 2025 I wrote about moving my hobby projects to a European cloud provider. I did an initial, manual setup in Hetzner, which I\u0026rsquo;ve now automated. This weekend, I tested the setup. It takes me a few minutes now to get everything moved to a new host, and most of that has to do with DNS. I\u0026rsquo;ve got a reproducible setup, I can quickly provision up a machine locally or in any cloud that has Ubuntu 24.04. Reproducible infrastructure is ‚ú®liberating‚ú®\n","keywords":["cloud","linux","ops","cdn","duckdb","caddy","ansible"],"articleBody":"In Running containers on no-ops linux in 2025 I wrote about moving my hobby projects to a European cloud provider. I did an initial, manual setup in Hetzner, which I‚Äôve now automated. This weekend, I tested the setup. It takes me a few minutes now to get everything moved to a new host, and most of that has to do with DNS. I‚Äôve got a reproducible setup, I can quickly provision up a machine locally or in any cloud that has Ubuntu 24.04. Reproducible infrastructure is ‚ú®liberating‚ú®\nThe goal is to document how to make a fire-and-forget Linux server that will mostly take care of its own ops, with an acceptable uptime and security level for my hobby projects. Once we‚Äôre done, the server will:\nUpdate its packages, and reboot during nighttime, when required by updates. Run a caddy proxy on the host system, ensuring everything‚Äôs hosted on TLS with certificates issued from letsencrypt. Run several persistent rootless containers using podman, with a setup that brings them up on boot. Run a nightly job that updates some data and performs a rolling restart of some containers. The job runs in a container too. The data lives in S3-compatible object storage. Take care of automatically updating the containers. We‚Äôll also set up some monitoring so we can have üì®email notifications if the containers aren‚Äôt working right. This covers a lot of ground, some of it is quite detailed. If you‚Äôd like to skip this incredibly long and technical read, you could go over and investigate the source code over at github instead. It has been my goal to make something that other people can easily adapt to their own use. This description of how I made it might be a helpful guide to see which parts you should change or tinker with.\nThis post got so long that I broke it into three parts:\nThis post covers local development of linux server configuration and essentials. The next post covers installation of podman and caddy. It concludes by deploying a very simple stateless webapp in a container. The final post covers a more challenging deployment with jobs and rolling restarts, and discusses the strengths and weaknesses of this approach to hosting. Configuring Linux machines For the longest time, I had hoped to do this with cloud-init. You can provide a user-data script when you order a machine with almost every cloud provider. When you get access to the machine, it‚Äôs already configured (or very nearly done).\nYou shouldn‚Äôt be putting secrets in user-data scripts. You can make user accounts, add public keys to them and install software and all sorts of useful things. I played with the idea of just setting up a new VM with cloud-init every time I needed a config change and just replacing the old one. I like that idea a lot. I still want to do it. But I really didn‚Äôt find any good way of injecting the secrets that I require without manual intervention or reaching for a tool other than cloud-init.\nFor that reason I decided to settle for Ansible to configure the VMs, using ansible-vault to handle my secrets. There seemed little point in using cloud-init after that.\nBoth cloud-init and Ansible run counter to my goal of using as little YAML as possible, so that was deeply unsatisfying. But it works great! The last 8‚Äì12 years have given me a huge tolerance for YAML anyway. Surely, I‚Äôll survive? üòµ\nDeveloping Ansible code I had already decided to use Ubuntu 24.04 with unattended upgrades and unattended reboots. I wanted to develop locally, only ordering a server in a cloud when I was fairly confident I had a secure setup. The best way I know how to do that is to use Vagrant. This tool can manage virtual machines locally, applying tons of different configuration management tools to configure them. Crucially, it supports ansible. After installing VirtualBox I found a suitable Vagrant box and ran:\nvagrant init bento/ubuntu-24.04 This produces a Vagrantfile in the current directory. I edited mine to look like this:\nVagrant.configure(\"2\") do |config| config.vm.box = \"bento/ubuntu-24.04\" config.vm.provision \"ansible\" do |ansible| ansible.playbook = \"initialize.yml\" end end I put the following in initialize.yml, which is an ansible playbook:\n--- - name: Initialize Ubuntu host hosts: all become: true tasks: - name: Upgrade apt packages apt: update_cache: yes upgrade: yes - name: Ensure base packages apt: name: - vim - curl - git - unattended-upgrades - btop - iotop - nethogs - emacs-nox - strace - gnupg - lsb-release - systemd-container - nmap - fail2ban - ufw state: present Here‚Äôs a breakdown of the packages I put there:\nunattended-upgrades ensures that packages are upgraded without me doing anything on the machine. This represents a leap of faith that package upgrades won‚Äôt break anything. We will be taking some precautions to make sure we discover breakage, later. strace, nmap, nethogs, btop and iotop are tools that I can use to investigate the state of affairs on the machine. When I ssh to a machine to debug it, I usually assume that I have these available. curl is also invaluable to check proxy configuration. vim, git, emacs-nox are for interacting with source code or configuration on the machine. I don‚Äôt anticipate using these, but I‚Äôd rather not have to install them manually later. I put both vim and emacs there because I was feeling a little impulsive and wild. No sane person would use vim, of course. ü§™ I do sometimes, but please don‚Äôt tell any of my friends. fail2ban and ufw are security measures I want to use. fail2ban can be used to ban IPs that try to mess with the machine. Like bots that attempt to brute-force login to ssh. ufw is short for uncomplicated firewall, and that‚Äôs what it is. It‚Äôs a stateful firewall that‚Äôs straightforward to use. We need systemd-container to obtain machinectl, which is useful for letting ansible control user-specific systemd settings without dealing with D-Bus ourselves. lsb-releaseand gnupg are useful if we want to add more apt sources, to install non-standard packages. After this, we can bring up a virtual machine with:\nvagrant up It‚Äôll work for a while, then tell us the machine is configured. If we want to start over, we can use:\nvagrant destroy -f; vagrant up To reapply the playbook, we can use:\nvagrant provision To access an ssh-session, we can use:\nvagrant ssh # logs in with the vagrant@ user, who has passwordless sudo Now we have a nice and short feedback loop to iterate on the ansible configuration! No cloud required. Yet.\nAnsible best practices There are some best practices we can choose to follow. Usually, that‚Äôs a good idea. Since this is my hobby project, I will sometimes ignore some of them and undoubtedly regret it later. I simply haven‚Äôt worked with Ansible for almost 10 years, so I‚Äôm probably very outdated.\nBut there‚Äôs one best practice we‚Äôll try to follow closely: Keep the playbook lean, put most of the things into ‚Äúroles.‚Äù An ansible role is like a module. It can accept parameters and do many things. This gives us a way to assemble different playbooks out of different roles later, without doing so much work. So let‚Äôs introduce some more structure:\nmkdir -p roles/{caddy,base-install,app-user,podman}/{tasks,files,templates,handlers} find roles roles roles/podman roles/podman/tasks roles/podman/files roles/podman/templates roles/podman/handlers roles/base-install roles/base-install/tasks roles/base-install/files roles/base-install/templates roles/base-install/handlers roles/app-user roles/app-user/tasks roles/app-user/files roles/app-user/templates roles/app-user/handlers roles/caddy roles/caddy/tasks roles/caddy/files roles/caddy/templates roles/caddy/handlers Why would you make so many folders?? An ansible role is a directory that can consist of many parts. The most important ones are:\ntasks/main.yml defines (ideally idempotent) tasks that the role must run templates contain jinja2 templates that can be used to render configuration in tasks files can contain stuff that we want the tasks to copy. handlers/main.yml defines some handlers that can react to tasks that have run; for example to reload some service if the configuration changed. Let‚Äôs build out the roles one at a time. First, we‚Äôll edit initialize.yml so that it contains only this:\n--- - name: Initialize Ubuntu host hosts: all become: true roles: - base-install We‚Äôre moving the base packages to the base-install role, in roles/base-install/tasks/main.yml:\n--- - name: Upgrade apt packages apt: update_cache: yes upgrade: yes - name: Ensure base packages apt: name: - vim - curl - git - unattended-upgrades - btop - iotop - nethogs - emacs-nox - strace - gnupg - lsb-release - systemd-container - nmap - fail2ban - ufw state: present We can use vagrant provision to check it. There shouldn‚Äôt be any changes.\nSecuring base-install I want the base-install role to take care of a few more things:\nHardening sshd, so that it‚Äôs more challenging to break into the machine that way Creating an admin user so that we can disable ssh-login for root Configuring fail2ban and ufw These are things I‚Äôd like to set up on every machine, even if I end up with more machines eventually. Let‚Äôs get to work.\nHandlers First, we‚Äôll make some handlers that we‚Äôre going to want to notify. We can put these into roles/base-install/handlers/main.yml:\n--- - name: Reload unattended-upgrades service: name: unattended-upgrades state: restarted - name: Reload sshd service: name: ssh state: reloaded - name: Reload systemd systemd: daemon_reload: yes - name: Restart fail2ban ansible.builtin.service: name: fail2ban state: restarted unattended-upgrades We will want to add more tasks to roles/base-install/tasks/main.yml. Let‚Äôs start small by setting the hostname, timezone and enabling unattended upgrades. Let‚Äôs add these:\n- name: Set hostname to inventory hostname hostname: name: \"{{ inventory_hostname }}\" - name: Set timezone to Europe/Oslo community.general.timezone: name: Europe/Oslo - name: Enable unattended upgrades service: name: unattended-upgrades enabled: yes notify: Reload unattended upgrades - name: Configure unattended-upgrades copy: dest: /etc/apt/apt.conf.d/99unattended-upgrades-custom content: | Unattended-Upgrade::Automatic-Reboot \"true\"; Unattended-Upgrade::Automatic-Reboot-WithUsers \"true\"; Unattended-Upgrade::Automatic-Reboot-Time \"02:00\"; Unattended-Upgrade::SyslogEnable \"true\"; notify: Reload unattended upgrades We‚Äôll use vagrant provision to test that this does the expected thing. At this point, we could let the machine run for a few days and verify that it reboots when there‚Äôs a new security update, but we‚Äôre not going to do that. There‚Äôs still more work to do.\nSecuring sshd Let‚Äôs proceed to secure sshd a little more by adding new tasks to roles/base-install/tasks/main.yml again. I would like to block ssh-login with the root account, but before we can do that, we need to have an alternate account. vagrant has a dedicated vagrant user it can use, but we won‚Äôt be so lucky when we‚Äôre running ansible standalone against a cloud server, so we need to take care of this right away. Let‚Äôs set it up:\n- name: Create admin user: name: admin state: present shell: /bin/bash createhome: yes groups: sudo append: yes - name: Allow passwordless sudo for admin copy: dest: /etc/sudoers.d/admin content: \"admin ALL=(ALL) NOPASSWD:ALL\" mode: \"0440\" - name: Configure authorized_keys for admin with_items: \"{{ authorized_keys }}\" authorized_key: user: admin key: \"{{ item }}\" state: present Running vagrant provision now fails:\nfatal: [default]: FAILED! =\u003e {\"msg\": \"'authorized_keys' is undefined\"} That‚Äôs because we didn‚Äôt pass in any authorized_keys variable, but we use one in this role. Back to initialize.yml at the root:\n--- - name: Initialize Ubuntu host hosts: all become: true roles: - name: base-install vars: authorized_keys: - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE9K1p8B8FRCWJ0Ax4obDu+UsLzGgXDIdTYkCZ8FF54b üí°This changed the type of the list element in roles to an object, instead of a string. That‚Äôs because we need to send it vars now.\nThis is how we can pass a variable into a role. This isn‚Äôt the best place to put this key, but we‚Äôll find a better place later. vagrant provision now creates the admin user. You‚Äôll probably want to use a different public key unless you want me to have access to your vagrant box. We can check ssh access by running:\n# 2222 is the default port vagrant uses to communicate with the box ssh -p 2222 admin@localhost whoami admin Fantastic. It‚Äôs time to configure ssh. Let‚Äôs add this to roles/base-install/tasks/main.yml:\n- name: Require key for ssh-login copy: dest: /etc/ssh/sshd_config.d/harden.conf content: | PermitEmptyPasswords no LoginGraceTime 30s PasswordAuthentication no MaxAuthTries 3 MaxSessions 3 PermitRootLogin no notify: Reload sshd We put this configuration into /etc/ssh/sshd_config.d/harden.conf, because the standard sshd_config automatically loads all snippets it finds in there. That way, we don‚Äôt have to worry about package upgrades overwriting our configuration. This disables authenticating with passwords, and blocks attempts to log directly into the root account.\nfail2ban and ufw It‚Äôs time to get fail2ban up! This package scans the server logs and blocks IPs that attempt to break in. This reduces the amount of noisy logs on the server, so it‚Äôs a good idea to set it up even if you‚Äôre not worried about breakin attempts actually succeeding.\nHere‚Äôs what we‚Äôll add to roles/base-install/tasks/main.yml:\n- name: Create Fail2Ban jail.local configuration copy: dest: /etc/fail2ban/jail.local content: | [DEFAULT] bantime = 1h # An IP is banned if it has generated \"maxretry\" during the last \"findtime\" findtime = 10m maxretry = 5 [sshd] enabled = true port = ssh maxretry = 3 bantime = 24h owner: root group: root mode: '0644' notify: Restart fail2ban - name: Enable fail2ban service: name: fail2ban enabled: yes Once again, we can run vagrant provision to verify that everything looks okay. This fail2ban config will block IPs that attempt to break into sshd for 24 hours. At this point, we can lock ourselves out of our server very easily if we use the wrong username or ssh-key. So let‚Äôs not do that.\nLet‚Äôs get uncomplicated firewall up with some sane defaults by adding even more YAML to roles/base-install/tasks/main.yml:\n- name: Set UFW default policies community.general.ufw: default: deny direction: incoming - name: Set UFW default outgoing policy community.general.ufw: default: allow direction: outgoing - name: Allow SSH on port 22/tcp (standard port) community.general.ufw: rule: allow port: '22' proto: tcp comment: 'Allow SSH access' - name: Allow HTTP on port 80/tcp (standard port) community.general.ufw: rule: allow port: '80' proto: tcp comment: 'Allow HTTP access' - name: Allow HTTPS on port 443/tcp (standard port) community.general.ufw: rule: allow port: '443' proto: tcp comment: 'Allow HTTPS access' - name: Enable UFW community.general.ufw: state: enabled This blocks all incoming ports other than ssh, http and https. Since ufw is a stateful firewall, it‚Äôll notice that we‚Äôre using services like NTP and DNS and accept incoming packets from those when we want to use them, so it shouldn‚Äôt interfere with anything.\nWrapping up base-install At this point I would feel comfortable deploying this onto a server in the cloud. It‚Äôs very unlikely that anyone could succeed in breaking in, especially because there‚Äôs almost no attack surface. We can‚Äôt use this server for much other than reading manpages! In the next part, we‚Äôll make it a little more capable by setting up podman, a proxy and a simple container deployment.\n","wordCount":"2444","inLanguage":"en","datePublished":"2025-05-13T00:00:00Z","dateModified":"2025-05-13T00:00:00Z","author":{"@type":"Person","name":"Robin K√•veland"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kaveland.no/posts/2025-05-13-fire-and-forget-linux-p1/"},"publisher":{"@type":"Organization","name":"Robin's blog","logo":{"@type":"ImageObject","url":"https://kaveland.no/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kaveland.no/ accesskey=h title="Robin's blog (Alt + H)">Robin's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kaveland.no/about/ title=about><span>about</span></a></li><li><a href=https://kaveland.no/projects/ title=projects><span>projects</span></a></li><li><a href=https://kaveland.no/eugene/ title=eugene><span>eugene</span></a></li><li><a href=https://kaveland.no/thumper/ title=thumper><span>thumper</span></a></li><li><a href=https://kaveland.no/tags/ title=tags><span>tags</span></a></li><li><a href=https://kaveland.no/archives/ title=archives><span>archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kaveland.no/>Home</a>&nbsp;¬ª&nbsp;<a href=https://kaveland.no/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">No-ops Linux part 1: Automation, security and essentials</h1><div class=post-meta><span title='2025-05-13 00:00:00 +0000 UTC'>May 13, 2025</span>&nbsp;¬∑&nbsp;12 min&nbsp;¬∑&nbsp;2444 words&nbsp;¬∑&nbsp;Robin K√•veland&nbsp;|&nbsp;<a href=https://github.com/kaaveland/kaaveland.github.io/content/posts/2025-05-13-fire-and-forget-linux-p1.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#configuring-linux-machines>Configuring Linux machines</a></li><li><a href=#developing-ansible-code>Developing Ansible code</a></li><li><a href=#ansible-best-practices>Ansible best practices</a><ul><li><a href=#why-would-you-make-so-many-folders>Why would you make so many folders??</a></li><li><a href=#securing-base-install>Securing <code>base-install</code></a></li><li><a href=#wrapping-up-base-install>Wrapping up <code>base-install</code></a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>In <a href=/posts/2025-04-14-running-containers-on-the-cheap>Running containers on no-ops linux in 2025</a> I wrote about moving my hobby projects to a European cloud provider. I did an initial, manual setup in <a href=https://www.hetzner.com/>Hetzner</a>, which I&rsquo;ve now automated. This weekend, I tested the setup. It takes me a few minutes now to get everything moved to a new host, and most of that has to do with DNS. I&rsquo;ve got a reproducible setup, I can quickly provision up a machine locally or in any cloud that has Ubuntu 24.04. Reproducible infrastructure is ‚ú®liberating‚ú®</p><p>The goal is to document how to make a fire-and-forget Linux server that will mostly take care of its own ops, with an acceptable uptime and security level for my hobby projects. Once we&rsquo;re done, the server will:</p><ul><li>Update its packages, and reboot during nighttime, when required by updates.</li><li>Run a <a href=https://caddyserver.com/>caddy</a> proxy on the host system, ensuring everything&rsquo;s hosted on TLS with certificates issued from <a href=https://letsencrypt.org/>letsencrypt</a>.</li><li>Run several persistent rootless containers using <a href=https://podman.io/>podman</a>, with a setup that brings them up on boot.</li><li>Run a nightly job that updates some data and performs a rolling restart of some containers. The job runs in a container too. The data lives in S3-compatible object storage.</li><li>Take care of automatically updating the containers.</li><li>We&rsquo;ll also set up some monitoring so we can have üì®email notifications if the containers aren&rsquo;t working right.</li></ul><p>This covers a lot of ground, some of it is quite detailed. If you&rsquo;d like to skip this incredibly long and technical read, you could go over and investigate the source code over at <a href=https://github.com/kaaveland/fire-and-forget-linux>github</a> instead. It has been my goal to make something that other people can easily adapt to their own use. This description of how I made it might be a helpful guide to see which parts you should change or tinker with.</p><p>This post got so long that I broke it into three parts:</p><ol><li><a href=/posts/2025-05-13-fire-and-forget-linux-p1>This post</a> covers local development of linux server configuration and essentials.</li><li><a href=/posts/2025-05-14-fire-and-forget-linux-p2>The next post</a> covers installation of <a href=https://podman.io/>podman</a> and <a href=https://caddyserver.com/>caddy</a>. It concludes by deploying a very simple stateless webapp in a container.</li><li><a href=/posts/2025-05-14-fire-and-forget-linux-p3>The final post</a> covers a more challenging deployment with jobs and rolling restarts, and discusses the strengths and weaknesses of this approach to hosting.</li></ol><h2 id=configuring-linux-machines>Configuring Linux machines<a hidden class=anchor aria-hidden=true href=#configuring-linux-machines>#</a></h2><p>For the longest time, I had hoped to do this with <a href=https://cloudinit.readthedocs.io/en/latest/index.html>cloud-init</a>. You can provide a user-data script when you order a machine with almost every cloud provider. When you get access to the machine, it&rsquo;s already configured (or very nearly done).</p><p>You shouldn&rsquo;t be putting secrets in user-data scripts. You can make user accounts, add public keys to them and install software and all sorts of useful things. I played with the idea of just setting up a new VM with cloud-init every time I needed a config change and just replacing the old one. I like that idea a lot. I still want to do it. But I really didn&rsquo;t find any good way of injecting the secrets that I require without manual intervention or reaching for a tool other than cloud-init.</p><p>For that reason I decided to settle for <a href=https://docs.ansible.com/ansible/latest/index.html>Ansible</a> to configure the VMs, using <code>ansible-vault</code> to handle my secrets. There seemed little point in using cloud-init after that.</p><p>Both cloud-init and Ansible run counter to my goal of using as little YAML as possible, so that was deeply unsatisfying. But it works great! The last 8‚Äì12 years have given me a huge tolerance for YAML anyway. Surely, I&rsquo;ll survive? üòµ</p><h2 id=developing-ansible-code>Developing Ansible code<a hidden class=anchor aria-hidden=true href=#developing-ansible-code>#</a></h2><p>I had already decided to use Ubuntu 24.04 with unattended upgrades and unattended reboots. I wanted to develop locally, only ordering a server in a cloud when I was fairly confident I had a secure setup. The best way I know how to do that is to use <a href=https://developer.hashicorp.com/vagrant>Vagrant</a>. This tool can manage virtual machines locally, applying tons of different configuration management tools to configure them. Crucially, it supports ansible. After installing <a href=https://www.virtualbox.org/>VirtualBox</a> I found a suitable <a href=https://portal.cloud.hashicorp.com/vagrant/discover>Vagrant box</a> and ran:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vagrant init bento/ubuntu-24.04
</span></span></code></pre></div><p>This produces a Vagrantfile in the current directory. I edited mine to look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=no>Vagrant</span><span class=o>.</span><span class=n>configure</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>config</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=n>config</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>box</span> <span class=o>=</span> <span class=s2>&#34;bento/ubuntu-24.04&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>config</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>provision</span> <span class=s2>&#34;ansible&#34;</span> <span class=k>do</span> <span class=o>|</span><span class=n>ansible</span><span class=o>|</span>
</span></span><span class=line><span class=cl>    <span class=n>ansible</span><span class=o>.</span><span class=n>playbook</span> <span class=o>=</span> <span class=s2>&#34;initialize.yml&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><p>I put the following in <code>initialize.yml</code>, which is an ansible playbook:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Initialize Ubuntu host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Upgrade apt packages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>upgrade</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Ensure base packages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>vim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>curl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>git</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>unattended-upgrades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>btop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>iotop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>nethogs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>emacs-nox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>strace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>gnupg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>lsb-release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>systemd-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>nmap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>fail2ban</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>ufw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>present</span><span class=w>
</span></span></span></code></pre></div><p>Here&rsquo;s a breakdown of the packages I put there:</p><ul><li><code>unattended-upgrades</code> ensures that packages are upgraded without me doing anything on the machine. This represents a leap of faith that package upgrades won&rsquo;t break anything. We will be taking some precautions to make sure we discover breakage, later.</li><li><code>strace</code>, <code>nmap</code>, <code>nethogs</code>, <code>btop</code> and <code>iotop</code> are tools that I can use to investigate the state of affairs on the machine. When I <code>ssh</code> to a machine to debug it, I usually assume that I have these available. <code>curl</code> is also invaluable to check proxy configuration.</li><li><code>vim</code>, <code>git</code>, <code>emacs-nox</code> are for interacting with source code or configuration on the machine. I don&rsquo;t anticipate using these, but I&rsquo;d rather not have to install them manually later. I put both vim and emacs there because I was feeling a little impulsive and wild. No sane person would use <code>vim</code>, of course. ü§™ I do sometimes, but please don&rsquo;t tell any of my friends.</li><li><code>fail2ban</code> and <code>ufw</code> are security measures I want to use. <code>fail2ban</code> can be used to ban IPs that try to mess with the machine. Like bots that attempt to brute-force login to <code>ssh</code>. <code>ufw</code> is short for uncomplicated firewall, and that&rsquo;s what it is. It&rsquo;s a stateful firewall that&rsquo;s straightforward to use.</li><li>We need <code>systemd-container</code> to obtain <code>machinectl</code>, which is useful for letting ansible control user-specific systemd settings without dealing with <a href=https://en.wikipedia.org/wiki/D-Bus>D-Bus</a> ourselves.</li><li><code>lsb-release</code>and <code>gnupg</code> are useful if we want to add more apt sources, to install non-standard packages.</li></ul><p>After this, we can bring up a virtual machine with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vagrant up
</span></span></code></pre></div><p>It&rsquo;ll work for a while, then tell us the machine is configured. If we want to start over, we can use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vagrant destroy -f<span class=p>;</span> vagrant up
</span></span></code></pre></div><p>To reapply the playbook, we can use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vagrant provision
</span></span></code></pre></div><p>To access an ssh-session, we can use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vagrant ssh <span class=c1># logs in with the vagrant@ user, who has passwordless sudo</span>
</span></span></code></pre></div><p>Now we have a nice and short feedback loop to iterate on the ansible configuration! No cloud required. Yet.</p><h2 id=ansible-best-practices>Ansible best practices<a hidden class=anchor aria-hidden=true href=#ansible-best-practices>#</a></h2><p>There are some best practices we can choose to follow. Usually, that&rsquo;s a good idea. Since this is my hobby project, I will sometimes ignore some of them and undoubtedly regret it later. I simply haven&rsquo;t worked with Ansible for almost 10 years, so I&rsquo;m probably very outdated.</p><p>But there&rsquo;s one best practice we&rsquo;ll try to follow closely: Keep the playbook lean, put most of the things into &ldquo;roles.&rdquo; An ansible role is like a module. It can accept parameters and do many things. This gives us a way to assemble different playbooks out of different roles later, without doing so much work. So let&rsquo;s introduce some more structure:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p roles/<span class=o>{</span>caddy,base-install,app-user,podman<span class=o>}</span>/<span class=o>{</span>tasks,files,templates,handlers<span class=o>}</span>
</span></span><span class=line><span class=cl>find roles
</span></span><span class=line><span class=cl>roles
</span></span><span class=line><span class=cl>roles/podman
</span></span><span class=line><span class=cl>roles/podman/tasks
</span></span><span class=line><span class=cl>roles/podman/files
</span></span><span class=line><span class=cl>roles/podman/templates
</span></span><span class=line><span class=cl>roles/podman/handlers
</span></span><span class=line><span class=cl>roles/base-install
</span></span><span class=line><span class=cl>roles/base-install/tasks
</span></span><span class=line><span class=cl>roles/base-install/files
</span></span><span class=line><span class=cl>roles/base-install/templates
</span></span><span class=line><span class=cl>roles/base-install/handlers
</span></span><span class=line><span class=cl>roles/app-user
</span></span><span class=line><span class=cl>roles/app-user/tasks
</span></span><span class=line><span class=cl>roles/app-user/files
</span></span><span class=line><span class=cl>roles/app-user/templates
</span></span><span class=line><span class=cl>roles/app-user/handlers
</span></span><span class=line><span class=cl>roles/caddy
</span></span><span class=line><span class=cl>roles/caddy/tasks
</span></span><span class=line><span class=cl>roles/caddy/files
</span></span><span class=line><span class=cl>roles/caddy/templates
</span></span><span class=line><span class=cl>roles/caddy/handlers
</span></span></code></pre></div><h3 id=why-would-you-make-so-many-folders>Why would you make so many folders??<a hidden class=anchor aria-hidden=true href=#why-would-you-make-so-many-folders>#</a></h3><p>An ansible role is a directory that can consist of many parts. The most important ones are:</p><ul><li><code>tasks/main.yml</code> defines (ideally idempotent) tasks that the role must run</li><li><code>templates</code> contain <a href=https://jinja.palletsprojects.com/en/stable/templates/>jinja2</a> templates that can be used to render configuration in tasks</li><li><code>files</code> can contain stuff that we want the tasks to copy.</li><li><code>handlers/main.yml</code> defines some handlers that can react to tasks that have run; for example to reload some service if the configuration changed.</li></ul><p>Let&rsquo;s build out the roles one at a time. First, we&rsquo;ll edit <code>initialize.yml</code> so that it contains only this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Initialize Ubuntu host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>roles</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>base-install</span><span class=w>
</span></span></span></code></pre></div><p>We&rsquo;re moving the base packages to the base-install role, in <code>roles/base-install/tasks/main.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Upgrade apt packages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>upgrade</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Ensure base packages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vim</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>curl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>git</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>unattended-upgrades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>btop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>iotop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>nethogs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>emacs-nox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>strace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>gnupg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>lsb-release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>systemd-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>nmap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>fail2ban</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ufw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>present</span><span class=w>
</span></span></span></code></pre></div><p>We can use <code>vagrant provision</code> to check it. There shouldn&rsquo;t be any changes.</p><h3 id=securing-base-install>Securing <code>base-install</code><a hidden class=anchor aria-hidden=true href=#securing-base-install>#</a></h3><p>I want the <code>base-install</code> role to take care of a few more things:</p><ul><li>Hardening <code>sshd</code>, so that it&rsquo;s more challenging to break into the machine that way</li><li>Creating an <code>admin</code> user so that we can disable ssh-login for <code>root</code></li><li>Configuring <code>fail2ban</code> and <code>ufw</code></li></ul><p>These are things I&rsquo;d like to set up on every machine, even if I end up with more machines eventually. Let&rsquo;s get to work.</p><h4 id=handlers>Handlers<a hidden class=anchor aria-hidden=true href=#handlers>#</a></h4><p>First, we&rsquo;ll make some handlers that we&rsquo;re going to want to notify. We can put these into <code>roles/base-install/handlers/main.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Reload unattended-upgrades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>unattended-upgrades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>restarted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Reload sshd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ssh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>reloaded</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Reload systemd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>systemd</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>daemon_reload</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Restart fail2ban</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>fail2ban</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>restarted</span><span class=w>
</span></span></span></code></pre></div><h4 id=unattended-upgrades>unattended-upgrades<a hidden class=anchor aria-hidden=true href=#unattended-upgrades>#</a></h4><p>We will want to add more tasks to <code>roles/base-install/tasks/main.yml</code>. Let&rsquo;s start small by setting the hostname, timezone and enabling unattended upgrades. Let&rsquo;s add these:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set hostname to inventory hostname</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ inventory_hostname }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set timezone to Europe/Oslo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>community.general.timezone</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Europe/Oslo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Enable unattended upgrades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>unattended-upgrades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class=l>Reload unattended upgrades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Configure unattended-upgrades</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>copy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=l>/etc/apt/apt.conf.d/99unattended-upgrades-custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>content</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      Unattended-Upgrade::Automatic-Reboot &#34;true&#34;;
</span></span></span><span class=line><span class=cl><span class=sd>      Unattended-Upgrade::Automatic-Reboot-WithUsers &#34;true&#34;;
</span></span></span><span class=line><span class=cl><span class=sd>      Unattended-Upgrade::Automatic-Reboot-Time &#34;02:00&#34;;
</span></span></span><span class=line><span class=cl><span class=sd>      Unattended-Upgrade::SyslogEnable &#34;true&#34;;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class=l>Reload unattended upgrades</span><span class=w>
</span></span></span></code></pre></div><p>We&rsquo;ll use <code>vagrant provision</code> to test that this does the expected thing. At this point, we could let the machine run for a few days and verify that it reboots when there&rsquo;s a new security update, but we&rsquo;re not going to do that. There&rsquo;s still more work to do.</p><h4 id=securing-sshd>Securing <code>sshd</code><a hidden class=anchor aria-hidden=true href=#securing-sshd>#</a></h4><p>Let&rsquo;s proceed to secure <code>sshd</code> a little more by adding new tasks to <code>roles/base-install/tasks/main.yml</code> again. I would like to block ssh-login with the <code>root</code> account, but before we can do that, we need to have an alternate account. <code>vagrant</code> has a dedicated <code>vagrant</code> user it can use, but we won&rsquo;t be so lucky when we&rsquo;re running ansible standalone against a cloud server, so we need to take care of this right away. Let&rsquo;s set it up:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Create admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>/bin/bash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>createhome</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>groups</span><span class=p>:</span><span class=w> </span><span class=l>sudo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Allow passwordless sudo for admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>copy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=l>/etc/sudoers.d/admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>content</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;admin ALL=(ALL) NOPASSWD:ALL&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0440&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Configure authorized_keys for admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>with_items</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ authorized_keys }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>authorized_key</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span></span></span></code></pre></div><p>Running <code>vagrant provision</code> now fails:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>fatal: <span class=o>[</span>default<span class=o>]</span>: FAILED! <span class=o>=</span>&gt; <span class=o>{</span><span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;&#39;authorized_keys&#39; is undefined&#34;</span><span class=o>}</span>
</span></span></code></pre></div><p>That&rsquo;s because we didn&rsquo;t pass in any <code>authorized_keys</code> variable, but we use one in this role. Back to <code>initialize.yml</code> at the root:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Initialize Ubuntu host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>roles</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>base-install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>authorized_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE9K1p8B8FRCWJ0Ax4obDu+UsLzGgXDIdTYkCZ8FF54b</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>üí°This changed the type of the list element in roles to an object, instead of a string. That&rsquo;s because we need to send it <code>vars</code> now.</p></blockquote><p>This is how we can pass a variable into a role. This isn&rsquo;t the best place to put this key, but we&rsquo;ll find a better place later. <code>vagrant provision</code> now creates the <code>admin</code> user. You&rsquo;ll probably want to use a different public key unless you want me to have access to your vagrant box. We can check ssh access by running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 2222 is the default port vagrant uses to communicate with the box</span>
</span></span><span class=line><span class=cl>ssh -p <span class=m>2222</span> admin@localhost whoami
</span></span><span class=line><span class=cl>admin
</span></span></code></pre></div><p>Fantastic. It&rsquo;s time to configure ssh. Let&rsquo;s add this to <code>roles/base-install/tasks/main.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Require key for ssh-login</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>copy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=l>/etc/ssh/sshd_config.d/harden.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>content</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      PermitEmptyPasswords no
</span></span></span><span class=line><span class=cl><span class=sd>      LoginGraceTime 30s
</span></span></span><span class=line><span class=cl><span class=sd>      PasswordAuthentication no
</span></span></span><span class=line><span class=cl><span class=sd>      MaxAuthTries 3
</span></span></span><span class=line><span class=cl><span class=sd>      MaxSessions 3
</span></span></span><span class=line><span class=cl><span class=sd>      PermitRootLogin no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class=l>Reload sshd</span><span class=w>
</span></span></span></code></pre></div><p>We put this configuration into <code>/etc/ssh/sshd_config.d/harden.conf</code>, because the standard <code>sshd_config</code> automatically loads all snippets it finds in there. That way, we don&rsquo;t have to worry about package upgrades overwriting our configuration. This disables authenticating with passwords, and blocks attempts to log directly into the <code>root</code> account.</p><h4 id=fail2ban-and-ufw><code>fail2ban</code> and <code>ufw</code><a hidden class=anchor aria-hidden=true href=#fail2ban-and-ufw>#</a></h4><p>It&rsquo;s time to get <code>fail2ban</code> up! This package scans the server logs and blocks IPs that attempt to break in. This reduces the amount of noisy logs on the server, so it&rsquo;s a good idea to set it up even if you&rsquo;re not worried about breakin attempts actually succeeding.</p><p>Here&rsquo;s what we&rsquo;ll add to <code>roles/base-install/tasks/main.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Create Fail2Ban jail.local configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>copy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=l>/etc/fail2ban/jail.local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>content</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      [DEFAULT]
</span></span></span><span class=line><span class=cl><span class=sd>      bantime = 1h
</span></span></span><span class=line><span class=cl><span class=sd>      # An IP is banned if it has generated &#34;maxretry&#34; during the last &#34;findtime&#34;
</span></span></span><span class=line><span class=cl><span class=sd>      findtime = 10m
</span></span></span><span class=line><span class=cl><span class=sd>      maxretry = 5
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      [sshd]
</span></span></span><span class=line><span class=cl><span class=sd>      enabled = true
</span></span></span><span class=line><span class=cl><span class=sd>      port = ssh
</span></span></span><span class=line><span class=cl><span class=sd>      maxretry = 3
</span></span></span><span class=line><span class=cl><span class=sd>      bantime = 24h</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;0644&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>notify</span><span class=p>:</span><span class=w> </span><span class=l>Restart fail2ban</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Enable fail2ban</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>fail2ban</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span></code></pre></div><p>Once again, we can run <code>vagrant provision</code> to verify that everything looks okay. This <code>fail2ban</code> config will block IPs that attempt to break into <code>sshd</code> for 24 hours. At this point, we can lock ourselves out of our server very easily if we use the wrong username or ssh-key. So let&rsquo;s not do that.</p><p>Let&rsquo;s get uncomplicated firewall up with some sane defaults by adding even more YAML to <code>roles/base-install/tasks/main.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set UFW default policies</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>community.general.ufw</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default</span><span class=p>:</span><span class=w> </span><span class=l>deny</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>direction</span><span class=p>:</span><span class=w> </span><span class=l>incoming</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set UFW default outgoing policy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>community.general.ufw</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default</span><span class=p>:</span><span class=w> </span><span class=l>allow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>direction</span><span class=p>:</span><span class=w> </span><span class=l>outgoing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Allow SSH on port 22/tcp (standard port)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>community.general.ufw</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>allow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;22&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>proto</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Allow SSH access&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Allow HTTP on port 80/tcp (standard port)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>community.general.ufw</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>allow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;80&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>proto</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Allow HTTP access&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Allow HTTPS on port 443/tcp (standard port)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>community.general.ufw</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>allow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;443&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>proto</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>comment</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Allow HTTPS access&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Enable UFW</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>community.general.ufw</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>enabled</span><span class=w>
</span></span></span></code></pre></div><p>This blocks all incoming ports other than <code>ssh</code>, <code>http</code> and <code>https</code>. Since <code>ufw</code> is a stateful firewall, it&rsquo;ll notice that we&rsquo;re using services like NTP and DNS and accept incoming packets from those when we want to use them, so it shouldn&rsquo;t interfere with anything.</p><h3 id=wrapping-up-base-install>Wrapping up <code>base-install</code><a hidden class=anchor aria-hidden=true href=#wrapping-up-base-install>#</a></h3><p>At this point I would feel comfortable deploying this onto a server in the cloud. It&rsquo;s very unlikely that anyone could succeed in breaking in, especially because there&rsquo;s almost no attack surface. We can&rsquo;t use this server for much other than reading manpages! In the <a href=/posts/2025-05-14-fire-and-forget-linux-p2>next part</a>, we&rsquo;ll make it a little more capable by setting up podman, a proxy and a simple container deployment.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kaveland.no/tags/cloud/>Cloud</a></li><li><a href=https://kaveland.no/tags/linux/>Linux</a></li><li><a href=https://kaveland.no/tags/ops/>Ops</a></li><li><a href=https://kaveland.no/tags/cdn/>Cdn</a></li><li><a href=https://kaveland.no/tags/duckdb/>Duckdb</a></li><li><a href=https://kaveland.no/tags/caddy/>Caddy</a></li><li><a href=https://kaveland.no/tags/ansible/>Ansible</a></li></ul><nav class=paginav><a class=prev href=https://kaveland.no/posts/2025-05-14-fire-and-forget-linux-p2/><span class=title>¬´ Prev</span><br><span>No-ops linux part 2: Hosting a simple container on a lean mean systemd machine</span>
</a><a class=next href=https://kaveland.no/posts/2025-05-06-produce-or-consume/><span class=title>Next ¬ª</span><br><span>To create, or be consumed? That is the question</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share No-ops Linux part 1: Automation, security and essentials on x" href="https://x.com/intent/tweet/?text=No-ops%20Linux%20part%201%3a%20Automation%2c%20security%20and%20essentials&amp;url=https%3a%2f%2fkaveland.no%2fposts%2f2025-05-13-fire-and-forget-linux-p1%2f&amp;hashtags=cloud%2clinux%2cops%2ccdn%2cduckdb%2ccaddy%2cansible"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share No-ops Linux part 1: Automation, security and essentials on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fkaveland.no%2fposts%2f2025-05-13-fire-and-forget-linux-p1%2f&amp;title=No-ops%20Linux%20part%201%3a%20Automation%2c%20security%20and%20essentials&amp;summary=No-ops%20Linux%20part%201%3a%20Automation%2c%20security%20and%20essentials&amp;source=https%3a%2f%2fkaveland.no%2fposts%2f2025-05-13-fire-and-forget-linux-p1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share No-ops Linux part 1: Automation, security and essentials on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fkaveland.no%2fposts%2f2025-05-13-fire-and-forget-linux-p1%2f&title=No-ops%20Linux%20part%201%3a%20Automation%2c%20security%20and%20essentials"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share No-ops Linux part 1: Automation, security and essentials on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fkaveland.no%2fposts%2f2025-05-13-fire-and-forget-linux-p1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share No-ops Linux part 1: Automation, security and essentials on whatsapp" href="https://api.whatsapp.com/send?text=No-ops%20Linux%20part%201%3a%20Automation%2c%20security%20and%20essentials%20-%20https%3a%2f%2fkaveland.no%2fposts%2f2025-05-13-fire-and-forget-linux-p1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share No-ops Linux part 1: Automation, security and essentials on telegram" href="https://telegram.me/share/url?text=No-ops%20Linux%20part%201%3a%20Automation%2c%20security%20and%20essentials&amp;url=https%3a%2f%2fkaveland.no%2fposts%2f2025-05-13-fire-and-forget-linux-p1%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share No-ops Linux part 1: Automation, security and essentials on ycombinator" href="https://news.ycombinator.com/submitlink?t=No-ops%20Linux%20part%201%3a%20Automation%2c%20security%20and%20essentials&u=https%3a%2f%2fkaveland.no%2fposts%2f2025-05-13-fire-and-forget-linux-p1%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://kaveland.no/>Robin's blog</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>